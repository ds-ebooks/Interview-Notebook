<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Java 容器 | 秋招面试笔记 </title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="gitbook/style.css">
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="./Java 并发.html" />
    
    
    <link rel="prev" href="./Java 基础.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="5"
        data-chapter-title="Java 容器"
        data-filepath="Java 容器.md"
        data-basepath="."
        data-revision="Fri Jul 27 2018 09:46:41 GMT+0800 (中国标准时间)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="Git.html">
            
                
                    <a href="./Git.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Git
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="HTTP.html">
            
                
                    <a href="./HTTP.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        HTTP
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="Java IO.html">
            
                
                    <a href="./Java IO.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Java IO
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="Java 基础.html">
            
                
                    <a href="./Java 基础.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Java 基础
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="5" data-path="Java 容器.html">
            
                
                    <a href="./Java 容器.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Java 容器
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="Java 并发.html">
            
                
                    <a href="./Java 并发.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        Java 并发
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7" data-path="Java 虚拟机.html">
            
                
                    <a href="./Java 虚拟机.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        Java 虚拟机
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8" data-path="Leetcode 题解.html">
            
                
                    <a href="./Leetcode 题解.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        Leetcode 题解
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9" data-path="Leetcode-Database 题解.html">
            
                
                    <a href="./Leetcode-Database 题解.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        Leetcode-Database 题解
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10" data-path="Linux.html">
            
                
                    <a href="./Linux.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        Linux
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="11" data-path="MySQL.html">
            
                
                    <a href="./MySQL.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                        My SQL
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="12" data-path="Redis.html">
            
                
                    <a href="./Redis.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>12.</b>
                        
                        Redis
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="13" data-path="Socket.html">
            
                
                    <a href="./Socket.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>13.</b>
                        
                        Socket
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="14" data-path="SQL.html">
            
                
                    <a href="./SQL.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>14.</b>
                        
                        SQL
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="15" data-path="一致性.html">
            
                
                    <a href="./一致性.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>15.</b>
                        
                        一致性
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="16" data-path="代码可读性.html">
            
                
                    <a href="./代码可读性.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>16.</b>
                        
                        代码可读性
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="17" data-path="代码风格规范.html">
            
                
                    <a href="./代码风格规范.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>17.</b>
                        
                        代码风格规范
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="18" data-path="分布式问题分析.html">
            
                
                    <a href="./分布式问题分析.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>18.</b>
                        
                        分布式问题分析
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="19" data-path="剑指 offer 题解.html">
            
                
                    <a href="./剑指 offer 题解.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>19.</b>
                        
                        剑指 offer 题解
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="20" data-path="数据库系统原理.html">
            
                
                    <a href="./数据库系统原理.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>20.</b>
                        
                        数据库系统原理
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="21" data-path="正则表达式.html">
            
                
                    <a href="./正则表达式.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>21.</b>
                        
                        正则表达式
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="22" data-path="算法.html">
            
                
                    <a href="./算法.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>22.</b>
                        
                        算法
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="23" data-path="计算机操作系统.html">
            
                
                    <a href="./计算机操作系统.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>23.</b>
                        
                        计算机操作系统
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="24" data-path="计算机网络.html">
            
                
                    <a href="./计算机网络.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>24.</b>
                        
                        计算机网络
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="25" data-path="设计模式.html">
            
                
                    <a href="./设计模式.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>25.</b>
                        
                        设计模式
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="26" data-path="重构.html">
            
                
                    <a href="./重构.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>26.</b>
                        
                        重构
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="27" data-path="面向对象思想.html">
            
                
                    <a href="./面向对象思想.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>27.</b>
                        
                        面向对象思想
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >秋招面试笔记 </a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="java-&#x5BB9;&#x5668;">Java &#x5BB9;&#x5668;</h1>
<p>&#x539F;&#x4F5C;&#x8005;github: <a href="https://github.com/sjsdfg/Interview-Notebook-PDF" target="_blank">https://github.com/sjsdfg/Interview-Notebook-PDF</a></p>
<p>PDF&#x5236;&#x4F5C;github: <a href="https://github.com/sjsdfg/Interview-Notebook-PDF" target="_blank">https://github.com/sjsdfg/Interview-Notebook-PDF</a></p>
<h1 id="&#x4E00;&#x3001;&#x6982;&#x89C8;">&#x4E00;&#x3001;&#x6982;&#x89C8;</h1>
<p>&#x5BB9;&#x5668;&#x4E3B;&#x8981;&#x5305;&#x62EC; Collection &#x548C; Map &#x4E24;&#x79CD;&#xFF0C;Collection &#x53C8;&#x5305;&#x542B;&#x4E86; List&#x3001;Set &#x4EE5;&#x53CA; Queue&#x3002;</p>
<h2 id="collection">Collection</h2>
<p><div align="center"> <img src="https://github.com/CyC2018/Interview-Notebook/raw/master/pics/java-collections.png"> </div><br></p>
<h3 id="1-set">1. Set</h3>
<ul>
<li><p>HashSet&#xFF1A;&#x57FA;&#x4E8E;&#x54C8;&#x5E0C;&#x5B9E;&#x73B0;&#xFF0C;&#x652F;&#x6301;&#x5FEB;&#x901F;&#x67E5;&#x627E;&#xFF0C;&#x4F46;&#x4E0D;&#x652F;&#x6301;&#x6709;&#x5E8F;&#x6027;&#x64CD;&#x4F5C;&#xFF0C;&#x4F8B;&#x5982;&#x6839;&#x636E;&#x4E00;&#x4E2A;&#x8303;&#x56F4;&#x67E5;&#x627E;&#x5143;&#x7D20;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x5E76;&#x4E14;&#x5931;&#x53BB;&#x4E86;&#x5143;&#x7D20;&#x7684;&#x63D2;&#x5165;&#x987A;&#x5E8F;&#x4FE1;&#x606F;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x4F7F;&#x7528; Iterator &#x904D;&#x5386; HashSet &#x5F97;&#x5230;&#x7684;&#x7ED3;&#x679C;&#x662F;&#x4E0D;&#x786E;&#x5B9A;&#x7684;&#xFF1B;</p>
</li>
<li><p>TreeSet&#xFF1A;&#x57FA;&#x4E8E;&#x7EA2;&#x9ED1;&#x6811;&#x5B9E;&#x73B0;&#xFF0C;&#x652F;&#x6301;&#x6709;&#x5E8F;&#x6027;&#x64CD;&#x4F5C;&#xFF0C;&#x4F46;&#x662F;&#x67E5;&#x627E;&#x6548;&#x7387;&#x4E0D;&#x5982; HashSet&#xFF0C;HashSet &#x67E5;&#x627E;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A; O(1)&#xFF0C;TreeSet &#x5219;&#x4E3A; O(logN)&#xFF1B;</p>
</li>
<li><p>LinkedHashSet&#xFF1A;&#x5177;&#x6709; HashSet &#x7684;&#x67E5;&#x627E;&#x6548;&#x7387;&#xFF0C;&#x4E14;&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x94FE;&#x8868;&#x7EF4;&#x62A4;&#x5143;&#x7D20;&#x7684;&#x63D2;&#x5165;&#x987A;&#x5E8F;&#x3002;</p>
</li>
</ul>
<h3 id="2-list">2. List</h3>
<ul>
<li><p>ArrayList&#xFF1A;&#x57FA;&#x4E8E;&#x52A8;&#x6001;&#x6570;&#x7EC4;&#x5B9E;&#x73B0;&#xFF0C;&#x652F;&#x6301;&#x968F;&#x673A;&#x8BBF;&#x95EE;&#xFF1B;</p>
</li>
<li><p>Vector&#xFF1A;&#x548C; ArrayList &#x7C7B;&#x4F3C;&#xFF0C;&#x4F46;&#x5B83;&#x662F;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684;&#xFF1B;</p>
</li>
<li><p>LinkedList&#xFF1A;&#x57FA;&#x4E8E;&#x53CC;&#x5411;&#x94FE;&#x8868;&#x5B9E;&#x73B0;&#xFF0C;&#x53EA;&#x80FD;&#x987A;&#x5E8F;&#x8BBF;&#x95EE;&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x5730;&#x5728;&#x94FE;&#x8868;&#x4E2D;&#x95F4;&#x63D2;&#x5165;&#x548C;&#x5220;&#x9664;&#x5143;&#x7D20;&#x3002;&#x4E0D;&#x4EC5;&#x5982;&#x6B64;&#xFF0C;LinkedList &#x8FD8;&#x53EF;&#x4EE5;&#x7528;&#x4F5C;&#x6808;&#x3001;&#x961F;&#x5217;&#x548C;&#x53CC;&#x5411;&#x961F;&#x5217;&#x3002;</p>
</li>
</ul>
<h3 id="3-queue">3. Queue</h3>
<ul>
<li><p>LinkedList&#xFF1A;&#x53EF;&#x4EE5;&#x7528;&#x5B83;&#x6765;&#x652F;&#x6301;&#x53CC;&#x5411;&#x961F;&#x5217;&#xFF1B;</p>
</li>
<li><p>PriorityQueue&#xFF1A;&#x57FA;&#x4E8E;&#x5806;&#x7ED3;&#x6784;&#x5B9E;&#x73B0;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x5B83;&#x6765;&#x5B9E;&#x73B0;&#x4F18;&#x5148;&#x961F;&#x5217;&#x3002;</p>
</li>
</ul>
<h2 id="map">Map</h2>
<p><div align="center"> <img src="https://github.com/CyC2018/Interview-Notebook/raw/master/pics/java-collections1.png"> </div><br></p>
<ul>
<li><p>HashMap&#xFF1A;&#x57FA;&#x4E8E;&#x54C8;&#x5E0C;&#x5B9E;&#x73B0;&#xFF1B;</p>
</li>
<li><p>HashTable&#xFF1A;&#x548C; HashMap &#x7C7B;&#x4F3C;&#xFF0C;&#x4F46;&#x5B83;&#x662F;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x540C;&#x4E00;&#x65F6;&#x523B;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x53EF;&#x4EE5;&#x540C;&#x65F6;&#x5199;&#x5165; HashTable &#x5E76;&#x4E14;&#x4E0D;&#x4F1A;&#x5BFC;&#x81F4;&#x6570;&#x636E;&#x4E0D;&#x4E00;&#x81F4;&#x3002;&#x5B83;&#x662F;&#x9057;&#x7559;&#x7C7B;&#xFF0C;&#x4E0D;&#x5E94;&#x8BE5;&#x53BB;&#x4F7F;&#x7528;&#x5B83;&#x3002;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; ConcurrentHashMap &#x6765;&#x652F;&#x6301;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#xFF0C;&#x5E76;&#x4E14; ConcurrentHashMap &#x7684;&#x6548;&#x7387;&#x4F1A;&#x66F4;&#x9AD8;&#xFF0C;&#x56E0;&#x4E3A; ConcurrentHashMap &#x5F15;&#x5165;&#x4E86;&#x5206;&#x6BB5;&#x9501;&#x3002;</p>
</li>
<li><p>LinkedHashMap&#xFF1A;&#x4F7F;&#x7528;&#x94FE;&#x8868;&#x6765;&#x7EF4;&#x62A4;&#x5143;&#x7D20;&#x7684;&#x987A;&#x5E8F;&#xFF0C;&#x987A;&#x5E8F;&#x4E3A;&#x63D2;&#x5165;&#x987A;&#x5E8F;&#x6216;&#x8005;&#x6700;&#x8FD1;&#x6700;&#x5C11;&#x4F7F;&#x7528;&#xFF08;LRU&#xFF09;&#x987A;&#x5E8F;&#x3002;</p>
</li>
<li><p>TreeMap&#xFF1A;&#x57FA;&#x4E8E;&#x7EA2;&#x9ED1;&#x6811;&#x5B9E;&#x73B0;&#x3002;</p>
</li>
</ul>
<h1 id="&#x4E8C;&#x3001;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;">&#x4E8C;&#x3001;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;</h1>
<h2 id="&#x8FED;&#x4EE3;&#x5668;&#x6A21;&#x5F0F;">&#x8FED;&#x4EE3;&#x5668;&#x6A21;&#x5F0F;</h2>
<p><div align="center"> <img src="https://github.com/CyC2018/Interview-Notebook/raw/master/pics/Iterator-1.jpg"> </div><br></p>
<p>Collection &#x5B9E;&#x73B0;&#x4E86; Iterable &#x63A5;&#x53E3;&#xFF0C;&#x5176;&#x4E2D;&#x7684; iterator() &#x65B9;&#x6CD5;&#x80FD;&#x591F;&#x4EA7;&#x751F;&#x4E00;&#x4E2A; Iterator &#x5BF9;&#x8C61;&#xFF0C;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x5C31;&#x53EF;&#x4EE5;&#x8FED;&#x4EE3;&#x904D;&#x5386; Collection &#x4E2D;&#x7684;&#x5143;&#x7D20;&#x3002;</p>
<p>&#x4ECE; JDK 1.5 &#x4E4B;&#x540E;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; foreach &#x65B9;&#x6CD5;&#x6765;&#x904D;&#x5386;&#x5B9E;&#x73B0;&#x4E86; Iterable &#x63A5;&#x53E3;&#x7684;&#x805A;&#x5408;&#x5BF9;&#x8C61;&#x3002;</p>
<pre><code class="lang-java">List&lt;String&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
list.add(<span class="hljs-string">&quot;a&quot;</span>);
list.add(<span class="hljs-string">&quot;b&quot;</span>);
<span class="hljs-keyword">for</span> (String item : list) {
    System.out.println(item);
}
</code></pre>
<h2 id="&#x9002;&#x914D;&#x5668;&#x6A21;&#x5F0F;">&#x9002;&#x914D;&#x5668;&#x6A21;&#x5F0F;</h2>
<p>java.util.Arrays#asList() &#x53EF;&#x4EE5;&#x628A;&#x6570;&#x7EC4;&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#x4E3A; List &#x7C7B;&#x578B;&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-annotation">@SafeVarargs</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-function">List&lt;T&gt; <span class="hljs-title">asList</span><span class="hljs-params">(T... a)</span>
</span></code></pre>
<p>&#x5982;&#x679C;&#x8981;&#x5C06;&#x6570;&#x7EC4;&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#x4E3A; List &#x7C7B;&#x578B;&#xFF0C;&#x5E94;&#x8BE5;&#x6CE8;&#x610F;&#x7684;&#x662F; asList() &#x7684;&#x53C2;&#x6570;&#x4E3A;&#x6CDB;&#x578B;&#x7684;&#x53D8;&#x957F;&#x53C2;&#x6570;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x80FD;&#x4F7F;&#x7528;&#x57FA;&#x672C;&#x7C7B;&#x578B;&#x6570;&#x7EC4;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#xFF0C;&#x53EA;&#x80FD;&#x4F7F;&#x7528;&#x76F8;&#x5E94;&#x7684;&#x5305;&#x88C5;&#x7C7B;&#x578B;&#x6570;&#x7EC4;&#x3002;</p>
<pre><code class="lang-java">Integer[] arr = {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>};
List list = Arrays.asList(arr);
</code></pre>
<p>&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x65B9;&#x5F0F;&#x751F;&#x6210; List&#x3002;</p>
<pre><code class="lang-java">List list = Arrays.asList(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>);
</code></pre>
<h1 id="&#x4E09;&#x3001;&#x6E90;&#x7801;&#x5206;&#x6790;">&#x4E09;&#x3001;&#x6E90;&#x7801;&#x5206;&#x6790;</h1>
<p>&#x5982;&#x679C;&#x6CA1;&#x6709;&#x7279;&#x522B;&#x8BF4;&#x660E;&#xFF0C;&#x4EE5;&#x4E0B;&#x6E90;&#x7801;&#x5206;&#x6790;&#x57FA;&#x4E8E; JDK 1.8&#x3002;</p>
<p>&#x5728; IDEA &#x4E2D; double shift &#x8C03;&#x51FA; Search EveryWhere&#xFF0C;&#x67E5;&#x627E;&#x6E90;&#x7801;&#x6587;&#x4EF6;&#xFF0C;&#x627E;&#x5230;&#x4E4B;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x9605;&#x8BFB;&#x6E90;&#x7801;&#x3002;</p>
<h2 id="arraylist">ArrayList</h2>
<h3 id="1-&#x6982;&#x89C8;">1. &#x6982;&#x89C8;</h3>
<p>&#x5B9E;&#x73B0;&#x4E86; RandomAccess &#x63A5;&#x53E3;&#xFF0C;&#x56E0;&#x6B64;&#x652F;&#x6301;&#x968F;&#x673A;&#x8BBF;&#x95EE;&#xFF0C;&#x8FD9;&#x662F;&#x7406;&#x6240;&#x5F53;&#x7136;&#x7684;&#xFF0C;&#x56E0;&#x4E3A; ArrayList &#x662F;&#x57FA;&#x4E8E;&#x6570;&#x7EC4;&#x5B9E;&#x73B0;&#x7684;&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ArrayList</span>&lt;<span class="hljs-title">E</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractList</span>&lt;<span class="hljs-title">E</span>&gt;
        <span class="hljs-keyword">implements</span> <span class="hljs-title">List</span>&lt;<span class="hljs-title">E</span>&gt;, <span class="hljs-title">RandomAccess</span>, <span class="hljs-title">Cloneable</span>, <span class="hljs-title">java</span>.<span class="hljs-title">io</span>.<span class="hljs-title">Serializable</span>
</span></code></pre>
<p>&#x6570;&#x7EC4;&#x7684;&#x9ED8;&#x8BA4;&#x5927;&#x5C0F;&#x4E3A; 10&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> DEFAULT_CAPACITY = <span class="hljs-number">10</span>;
</code></pre>
<h3 id="2-&#x5E8F;&#x5217;&#x5316;">2. &#x5E8F;&#x5217;&#x5316;</h3>
<p>&#x57FA;&#x4E8E;&#x6570;&#x7EC4;&#x5B9E;&#x73B0;&#xFF0C;&#x4FDD;&#x5B58;&#x5143;&#x7D20;&#x7684;&#x6570;&#x7EC4;&#x4F7F;&#x7528; transient &#x4FEE;&#x9970;&#xFF0C;&#x8BE5;&#x5173;&#x952E;&#x5B57;&#x58F0;&#x660E;&#x6570;&#x7EC4;&#x9ED8;&#x8BA4;&#x4E0D;&#x4F1A;&#x88AB;&#x5E8F;&#x5217;&#x5316;&#x3002;ArrayList &#x5177;&#x6709;&#x52A8;&#x6001;&#x6269;&#x5BB9;&#x7279;&#x6027;&#xFF0C;&#x56E0;&#x6B64;&#x4FDD;&#x5B58;&#x5143;&#x7D20;&#x7684;&#x6570;&#x7EC4;&#x4E0D;&#x4E00;&#x5B9A;&#x90FD;&#x4F1A;&#x88AB;&#x4F7F;&#x7528;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x6CA1;&#x5FC5;&#x8981;&#x5168;&#x90E8;&#x8FDB;&#x884C;&#x5E8F;&#x5217;&#x5316;&#x3002;ArrayList &#x91CD;&#x5199;&#x4E86; writeObject() &#x548C; readObject() &#x6765;&#x63A7;&#x5236;&#x53EA;&#x5E8F;&#x5217;&#x5316;&#x6570;&#x7EC4;&#x4E2D;&#x6709;&#x5143;&#x7D20;&#x586B;&#x5145;&#x90A3;&#x90E8;&#x5206;&#x5185;&#x5BB9;&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-keyword">transient</span> Object[] elementData; <span class="hljs-comment">// non-private to simplify nested class access</span>
</code></pre>
<h3 id="3-&#x6269;&#x5BB9;">3. &#x6269;&#x5BB9;</h3>
<p>&#x6DFB;&#x52A0;&#x5143;&#x7D20;&#x65F6;&#x4F7F;&#x7528; ensureCapacityInternal() &#x65B9;&#x6CD5;&#x6765;&#x4FDD;&#x8BC1;&#x5BB9;&#x91CF;&#x8DB3;&#x591F;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x591F;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x4F7F;&#x7528; grow() &#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x6269;&#x5BB9;&#xFF0C;&#x65B0;&#x5BB9;&#x91CF;&#x7684;&#x5927;&#x5C0F;&#x4E3A; <code>oldCapacity + (oldCapacity &gt;&gt; 1)</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x65E7;&#x5BB9;&#x91CF;&#x7684; 1.5 &#x500D;&#x3002;</p>
<p>&#x6269;&#x5BB9;&#x64CD;&#x4F5C;&#x9700;&#x8981;&#x8C03;&#x7528; <code>Arrays.copyOf()</code> &#x628A;&#x539F;&#x6570;&#x7EC4;&#x6574;&#x4E2A;&#x590D;&#x5236;&#x5230;&#x65B0;&#x6570;&#x7EC4;&#x4E2D;&#xFF0C;&#x8FD9;&#x4E2A;&#x64CD;&#x4F5C;&#x4EE3;&#x4EF7;&#x5F88;&#x9AD8;&#xFF0C;&#x56E0;&#x6B64;&#x6700;&#x597D;&#x5728;&#x521B;&#x5EFA; ArrayList &#x5BF9;&#x8C61;&#x65F6;&#x5C31;&#x6307;&#x5B9A;&#x5927;&#x6982;&#x7684;&#x5BB9;&#x91CF;&#x5927;&#x5C0F;&#xFF0C;&#x51CF;&#x5C11;&#x6269;&#x5BB9;&#x64CD;&#x4F5C;&#x7684;&#x6B21;&#x6570;&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">add</span><span class="hljs-params">(E e)</span> </span>{
    ensureCapacityInternal(size + <span class="hljs-number">1</span>);  <span class="hljs-comment">// Increments modCount!!</span>
    elementData[size++] = e;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
}

<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ensureCapacityInternal</span><span class="hljs-params">(<span class="hljs-keyword">int</span> minCapacity)</span> </span>{
    <span class="hljs-keyword">if</span> (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) {
        minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);
    }
    ensureExplicitCapacity(minCapacity);
}

<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ensureExplicitCapacity</span><span class="hljs-params">(<span class="hljs-keyword">int</span> minCapacity)</span> </span>{
    modCount++;
    <span class="hljs-comment">// overflow-conscious code</span>
    <span class="hljs-keyword">if</span> (minCapacity - elementData.length &gt; <span class="hljs-number">0</span>)
        grow(minCapacity);
}

<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">grow</span><span class="hljs-params">(<span class="hljs-keyword">int</span> minCapacity)</span> </span>{
    <span class="hljs-comment">// overflow-conscious code</span>
    <span class="hljs-keyword">int</span> oldCapacity = elementData.length;
    <span class="hljs-keyword">int</span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class="hljs-number">1</span>);
    <span class="hljs-keyword">if</span> (newCapacity - minCapacity &lt; <span class="hljs-number">0</span>)
        newCapacity = minCapacity;
    <span class="hljs-keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="hljs-number">0</span>)
        newCapacity = hugeCapacity(minCapacity);
    <span class="hljs-comment">// minCapacity is usually close to size, so this is a win:</span>
    elementData = Arrays.copyOf(elementData, newCapacity);
}
</code></pre>
<h3 id="4-&#x5220;&#x9664;&#x5143;&#x7D20;">4. &#x5220;&#x9664;&#x5143;&#x7D20;</h3>
<p>&#x9700;&#x8981;&#x8C03;&#x7528; System.arraycopy() &#x5C06; index+1 &#x540E;&#x9762;&#x7684;&#x5143;&#x7D20;&#x90FD;&#x590D;&#x5236;&#x5230; index &#x4F4D;&#x7F6E;&#x4E0A;&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">remove</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index)</span> </span>{
    rangeCheck(index);
    modCount++;
    E oldValue = elementData(index);
    <span class="hljs-keyword">int</span> numMoved = size - index - <span class="hljs-number">1</span>;
    <span class="hljs-keyword">if</span> (numMoved &gt; <span class="hljs-number">0</span>)
        System.arraycopy(elementData, index+<span class="hljs-number">1</span>, elementData, index, numMoved);
    elementData[--size] = <span class="hljs-keyword">null</span>; <span class="hljs-comment">// clear to let GC do its work</span>
    <span class="hljs-keyword">return</span> oldValue;
}
</code></pre>
<h3 id="5-failfast">5. Fail-Fast</h3>
<p>modCount &#x7528;&#x6765;&#x8BB0;&#x5F55; ArrayList &#x7ED3;&#x6784;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x7684;&#x6B21;&#x6570;&#x3002;&#x7ED3;&#x6784;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x662F;&#x6307;&#x6DFB;&#x52A0;&#x6216;&#x8005;&#x5220;&#x9664;&#x81F3;&#x5C11;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x7684;&#x6240;&#x6709;&#x64CD;&#x4F5C;&#xFF0C;&#x6216;&#x8005;&#x662F;&#x8C03;&#x6574;&#x5185;&#x90E8;&#x6570;&#x7EC4;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x4EC5;&#x4EC5;&#x53EA;&#x662F;&#x8BBE;&#x7F6E;&#x5143;&#x7D20;&#x7684;&#x503C;&#x4E0D;&#x7B97;&#x7ED3;&#x6784;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x3002;</p>
<p>&#x5728;&#x8FDB;&#x884C;&#x5E8F;&#x5217;&#x5316;&#x6216;&#x8005;&#x8FED;&#x4EE3;&#x7B49;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x6BD4;&#x8F83;&#x64CD;&#x4F5C;&#x524D;&#x540E; modCount &#x662F;&#x5426;&#x6539;&#x53D8;&#xFF0C;&#x5982;&#x679C;&#x6539;&#x53D8;&#x4E86;&#x9700;&#x8981;&#x629B;&#x51FA; ConcurrentModificationException&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">writeObject</span><span class="hljs-params">(java.io.ObjectOutputStream s)</span>
    <span class="hljs-keyword">throws</span> java.io.IOException</span>{
    <span class="hljs-comment">// Write out element count, and any hidden stuff</span>
    <span class="hljs-keyword">int</span> expectedModCount = modCount;
    s.defaultWriteObject();

    <span class="hljs-comment">// Write out size as capacity for behavioural compatibility with clone()</span>
    s.writeInt(size);

    <span class="hljs-comment">// Write out all elements in the proper order.</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;size; i++) {
        s.writeObject(elementData[i]);
    }

    <span class="hljs-keyword">if</span> (modCount != expectedModCount) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ConcurrentModificationException();
    }
}
</code></pre>
<h2 id="vector">Vector</h2>
<h3 id="1-&#x540C;&#x6B65;">1. &#x540C;&#x6B65;</h3>
<p>&#x5B83;&#x7684;&#x5B9E;&#x73B0;&#x4E0E; ArrayList &#x7C7B;&#x4F3C;&#xFF0C;&#x4F46;&#x662F;&#x4F7F;&#x7528;&#x4E86; synchronized &#x8FDB;&#x884C;&#x540C;&#x6B65;&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">add</span><span class="hljs-params">(E e)</span> </span>{
    modCount++;
    ensureCapacityHelper(elementCount + <span class="hljs-number">1</span>);
    elementData[elementCount++] = e;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
}

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> E <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index)</span> </span>{
    <span class="hljs-keyword">if</span> (index &gt;= elementCount)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArrayIndexOutOfBoundsException(index);

    <span class="hljs-keyword">return</span> elementData(index);
}
</code></pre>
<h3 id="2-arraylist-&#x4E0E;-vector">2. ArrayList &#x4E0E; Vector</h3>
<ul>
<li>Vector &#x662F;&#x540C;&#x6B65;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x5F00;&#x9500;&#x5C31;&#x6BD4; ArrayList &#x8981;&#x5927;&#xFF0C;&#x8BBF;&#x95EE;&#x901F;&#x5EA6;&#x66F4;&#x6162;&#x3002;&#x6700;&#x597D;&#x4F7F;&#x7528; ArrayList &#x800C;&#x4E0D;&#x662F; Vector&#xFF0C;&#x56E0;&#x4E3A;&#x540C;&#x6B65;&#x64CD;&#x4F5C;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x7531;&#x7A0B;&#x5E8F;&#x5458;&#x81EA;&#x5DF1;&#x6765;&#x63A7;&#x5236;&#xFF1B;</li>
<li>Vector &#x6BCF;&#x6B21;&#x6269;&#x5BB9;&#x8BF7;&#x6C42;&#x5176;&#x5927;&#x5C0F;&#x7684; 2 &#x500D;&#x7A7A;&#x95F4;&#xFF0C;&#x800C; ArrayList &#x662F; 1.5 &#x500D;&#x3002;</li>
</ul>
<h3 id="3-vector-&#x66FF;&#x4EE3;&#x65B9;&#x6848;">3. Vector &#x66FF;&#x4EE3;&#x65B9;&#x6848;</h3>
<p>&#x4E3A;&#x4E86;&#x83B7;&#x5F97;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684; ArrayList&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>Collections.synchronizedList();</code> &#x5F97;&#x5230;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684; ArrayList&#x3002;</p>
<pre><code class="lang-java">List&lt;String&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
List&lt;String&gt; synList = Collections.synchronizedList(list);
</code></pre>
<p>&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; concurrent &#x5E76;&#x53D1;&#x5305;&#x4E0B;&#x7684; CopyOnWriteArrayList &#x7C7B;&#x3002;</p>
<pre><code class="lang-java">List&lt;String&gt; list = <span class="hljs-keyword">new</span> CopyOnWriteArrayList&lt;&gt;();
</code></pre>
<p>CopyOnWriteArrayList &#x662F;&#x4E00;&#x79CD; CopyOnWrite &#x5BB9;&#x5668;&#xFF0C;&#x4ECE;&#x4EE5;&#x4E0B;&#x6E90;&#x7801;&#x770B;&#x51FA;&#xFF1A;&#x8BFB;&#x53D6;&#x5143;&#x7D20;&#x662F;&#x4ECE;&#x539F;&#x6570;&#x7EC4;&#x8BFB;&#x53D6;&#xFF1B;&#x6DFB;&#x52A0;&#x5143;&#x7D20;&#x662F;&#x5728;&#x590D;&#x5236;&#x7684;&#x65B0;&#x6570;&#x7EC4;&#x4E0A;&#x3002;&#x8BFB;&#x5199;&#x5206;&#x79BB;&#xFF0C;&#x56E0;&#x800C;&#x53EF;&#x4EE5;&#x5728;&#x5E76;&#x53D1;&#x6761;&#x4EF6;&#x4E0B;&#x8FDB;&#x884C;&#x4E0D;&#x52A0;&#x9501;&#x7684;&#x8BFB;&#x53D6;&#xFF0C;&#x8BFB;&#x53D6;&#x6548;&#x7387;&#x9AD8;&#xFF0C;&#x9002;&#x7528;&#x4E8E;&#x8BFB;&#x64CD;&#x4F5C;&#x8FDC;&#x5927;&#x4E8E;&#x5199;&#x64CD;&#x4F5C;&#x7684;&#x573A;&#x666F;&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">add</span><span class="hljs-params">(E e)</span> </span>{
    <span class="hljs-keyword">final</span> ReentrantLock lock = <span class="hljs-keyword">this</span>.lock;
    lock.lock();
    <span class="hljs-keyword">try</span> {
        Object[] elements = getArray();
        <span class="hljs-keyword">int</span> len = elements.length;
        Object[] newElements = Arrays.copyOf(elements, len + <span class="hljs-number">1</span>); 
        newElements[len] = e;
        setArray(newElements);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    } <span class="hljs-keyword">finally</span> {
        lock.unlock();
    }
}

<span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setArray</span><span class="hljs-params">(Object[] a)</span> </span>{
    array = a;
}

<span class="hljs-annotation">@SuppressWarnings</span>(<span class="hljs-string">&quot;unchecked&quot;</span>)
<span class="hljs-function"><span class="hljs-keyword">private</span> E <span class="hljs-title">get</span><span class="hljs-params">(Object[] a, <span class="hljs-keyword">int</span> index)</span> </span>{
    <span class="hljs-keyword">return</span> (E) a[index];
}
</code></pre>
<h2 id="linkedlist">LinkedList</h2>
<h3 id="1-&#x6982;&#x89C8;">1. &#x6982;&#x89C8;</h3>
<p>&#x57FA;&#x4E8E;&#x53CC;&#x5411;&#x94FE;&#x8868;&#x5B9E;&#x73B0;&#xFF0C;&#x5185;&#x90E8;&#x4F7F;&#x7528; Node &#x6765;&#x5B58;&#x50A8;&#x94FE;&#x8868;&#x8282;&#x70B9;&#x4FE1;&#x606F;&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Node</span>&lt;<span class="hljs-title">E</span>&gt; </span>{
    E item;
    Node&lt;E&gt; next;
    Node&lt;E&gt; prev;
}
</code></pre>
<p>&#x6BCF;&#x4E2A;&#x94FE;&#x8868;&#x5B58;&#x50A8;&#x4E86; Head &#x548C; Tail &#x6307;&#x9488;&#xFF1A;</p>
<pre><code class="lang-java"><span class="hljs-keyword">transient</span> Node&lt;E&gt; first;
<span class="hljs-keyword">transient</span> Node&lt;E&gt; last;
</code></pre>
<p><div align="center"> <img src="https://github.com/CyC2018/Interview-Notebook/raw/master/pics/5158bc2f-83a6-4351-817e-c9b07f955d76.png"> </div><br></p>
<h3 id="2-arraylist-&#x4E0E;-linkedlist">2. ArrayList &#x4E0E; LinkedList</h3>
<ul>
<li>ArrayList &#x57FA;&#x4E8E;&#x52A8;&#x6001;&#x6570;&#x7EC4;&#x5B9E;&#x73B0;&#xFF0C;LinkedList &#x57FA;&#x4E8E;&#x53CC;&#x5411;&#x94FE;&#x8868;&#x5B9E;&#x73B0;&#xFF1B;</li>
<li>ArrayList &#x652F;&#x6301;&#x968F;&#x673A;&#x8BBF;&#x95EE;&#xFF0C;LinkedList &#x4E0D;&#x652F;&#x6301;&#xFF1B;</li>
<li>LinkedList &#x5728;&#x4EFB;&#x610F;&#x4F4D;&#x7F6E;&#x6DFB;&#x52A0;&#x5220;&#x9664;&#x5143;&#x7D20;&#x66F4;&#x5FEB;&#x3002;</li>
</ul>
<h2 id="hashmap">HashMap</h2>
<p>&#x4E3A;&#x4E86;&#x4FBF;&#x4E8E;&#x7406;&#x89E3;&#xFF0C;&#x4EE5;&#x4E0B;&#x6E90;&#x7801;&#x5206;&#x6790;&#x4EE5; JDK 1.7 &#x4E3A;&#x4E3B;&#x3002;</p>
<h3 id="1-&#x5B58;&#x50A8;&#x7ED3;&#x6784;">1. &#x5B58;&#x50A8;&#x7ED3;&#x6784;</h3>
<p>&#x5185;&#x90E8;&#x5305;&#x542B;&#x4E86;&#x4E00;&#x4E2A; Entry &#x7C7B;&#x578B;&#x7684;&#x6570;&#x7EC4; table&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-keyword">transient</span> Entry[] table;
</code></pre>
<p>&#x5176;&#x4E2D;&#xFF0C;Entry &#x5C31;&#x662F;&#x5B58;&#x50A8;&#x6570;&#x636E;&#x7684;&#x952E;&#x503C;&#x5BF9;&#xFF0C;&#x5B83;&#x5305;&#x542B;&#x4E86;&#x56DB;&#x4E2A;&#x5B57;&#x6BB5;&#x3002;&#x4ECE; next &#x5B57;&#x6BB5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x51FA; Entry &#x662F;&#x4E00;&#x4E2A;&#x94FE;&#x8868;&#xFF0C;&#x5373;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x4F4D;&#x7F6E;&#x88AB;&#x5F53;&#x6210;&#x4E00;&#x4E2A;&#x6876;&#xFF0C;&#x4E00;&#x4E2A;&#x6876;&#x5B58;&#x653E;&#x4E00;&#x4E2A;&#x94FE;&#x8868;&#xFF0C;&#x94FE;&#x8868;&#x4E2D;&#x5B58;&#x653E;&#x54C8;&#x5E0C;&#x503C;&#x76F8;&#x540C;&#x7684; Entry&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;HashMap &#x4F7F;&#x7528;&#x62C9;&#x94FE;&#x6CD5;&#x6765;&#x89E3;&#x51B3;&#x51B2;&#x7A81;&#x3002;</p>
<p><div align="center"> <img src="https://github.com/CyC2018/Interview-Notebook/raw/master/pics/8fe838e3-ef77-4f63-bf45-417b6bc5c6bb.png"> </div><br></p>
<pre><code class="lang-java"><span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Entry</span>&lt;<span class="hljs-title">K</span>,<span class="hljs-title">V</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">Map</span>.<span class="hljs-title">Entry</span>&lt;<span class="hljs-title">K</span>,<span class="hljs-title">V</span>&gt; </span>{
    <span class="hljs-keyword">final</span> K key;
    V value;
    Entry&lt;K,V&gt; next;
    <span class="hljs-keyword">int</span> hash;

    Entry(<span class="hljs-keyword">int</span> h, K k, V v, Entry&lt;K,V&gt; n) {
        value = v;
        next = n;
        key = k;
        hash = h;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> K <span class="hljs-title">getKey</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> key;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> V <span class="hljs-title">getValue</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> value;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> V <span class="hljs-title">setValue</span><span class="hljs-params">(V newValue)</span> </span>{
        V oldValue = value;
        value = newValue;
        <span class="hljs-keyword">return</span> oldValue;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">equals</span><span class="hljs-params">(Object o)</span> </span>{
        <span class="hljs-keyword">if</span> (!(o <span class="hljs-keyword">instanceof</span> Map.Entry))
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        Map.Entry e = (Map.Entry)o;
        Object k1 = getKey();
        Object k2 = e.getKey();
        <span class="hljs-keyword">if</span> (k1 == k2 || (k1 != <span class="hljs-keyword">null</span> &amp;&amp; k1.equals(k2))) {
            Object v1 = getValue();
            Object v2 = e.getValue();
            <span class="hljs-keyword">if</span> (v1 == v2 || (v1 != <span class="hljs-keyword">null</span> &amp;&amp; v1.equals(v2)))
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> <span class="hljs-title">hashCode</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> Objects.hashCode(getKey()) ^ Objects.hashCode(getValue());
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> getKey() + <span class="hljs-string">&quot;=&quot;</span> + getValue();
    }

    <span class="hljs-comment">/**
     * This method is invoked whenever the value in an entry is
     * overwritten by an invocation of put(k,v) for a key k that&apos;s already
     * in the HashMap.
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">recordAccess</span><span class="hljs-params">(HashMap&lt;K,V&gt; m)</span> </span>{
    }

    <span class="hljs-comment">/**
     * This method is invoked whenever the entry is
     * removed from the table.
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">recordRemoval</span><span class="hljs-params">(HashMap&lt;K,V&gt; m)</span> </span>{
    }
}
</code></pre>
<h3 id="2-&#x62C9;&#x94FE;&#x6CD5;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;">2. &#x62C9;&#x94FE;&#x6CD5;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;</h3>
<pre><code class="lang-java">HashMap&lt;String, String&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
map.put(<span class="hljs-string">&quot;K1&quot;</span>, <span class="hljs-string">&quot;V1&quot;</span>);
map.put(<span class="hljs-string">&quot;K2&quot;</span>, <span class="hljs-string">&quot;V2&quot;</span>);
map.put(<span class="hljs-string">&quot;K3&quot;</span>, <span class="hljs-string">&quot;V3&quot;</span>);
</code></pre>
<ul>
<li>&#x65B0;&#x5EFA;&#x4E00;&#x4E2A; HashMap&#xFF0C;&#x9ED8;&#x8BA4;&#x5927;&#x5C0F;&#x4E3A; 16&#xFF1B;</li>
<li>&#x63D2;&#x5165; &lt;K1,V1&gt; &#x952E;&#x503C;&#x5BF9;&#xFF0C;&#x5148;&#x8BA1;&#x7B97; K1 &#x7684; hashCode &#x4E3A; 115&#xFF0C;&#x4F7F;&#x7528;&#x9664;&#x7559;&#x4F59;&#x6570;&#x6CD5;&#x5F97;&#x5230;&#x6240;&#x5728;&#x7684;&#x6876;&#x4E0B;&#x6807; 115%16=3&#x3002;</li>
<li>&#x63D2;&#x5165; &lt;K2,V2&gt; &#x952E;&#x503C;&#x5BF9;&#xFF0C;&#x5148;&#x8BA1;&#x7B97; K2 &#x7684; hashCode &#x4E3A; 118&#xFF0C;&#x4F7F;&#x7528;&#x9664;&#x7559;&#x4F59;&#x6570;&#x6CD5;&#x5F97;&#x5230;&#x6240;&#x5728;&#x7684;&#x6876;&#x4E0B;&#x6807; 118%16=6&#x3002;</li>
<li>&#x63D2;&#x5165; &lt;K3,V3&gt; &#x952E;&#x503C;&#x5BF9;&#xFF0C;&#x5148;&#x8BA1;&#x7B97; K3 &#x7684; hashCode &#x4E3A; 118&#xFF0C;&#x4F7F;&#x7528;&#x9664;&#x7559;&#x4F59;&#x6570;&#x6CD5;&#x5F97;&#x5230;&#x6240;&#x5728;&#x7684;&#x6876;&#x4E0B;&#x6807; 118%16=6&#xFF0C;&#x63D2;&#x5728; &lt;K2,V2&gt; &#x524D;&#x9762;&#x3002;</li>
</ul>
<p>&#x5E94;&#x8BE5;&#x6CE8;&#x610F;&#x5230;&#x94FE;&#x8868;&#x7684;&#x63D2;&#x5165;&#x662F;&#x4EE5;&#x5934;&#x63D2;&#x6CD5;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x7684;&#xFF0C;&#x4F8B;&#x5982;&#x4E0A;&#x9762;&#x7684; &lt;K3,V3&gt; &#x4E0D;&#x662F;&#x63D2;&#x5728; &lt;K2,V2&gt; &#x540E;&#x9762;&#xFF0C;&#x800C;&#x662F;&#x63D2;&#x5165;&#x5728;&#x94FE;&#x8868;&#x5934;&#x90E8;&#x3002;</p>
<p>&#x67E5;&#x627E;&#x9700;&#x8981;&#x5206;&#x6210;&#x4E24;&#x6B65;&#x8FDB;&#x884C;&#xFF1A;</p>
<ul>
<li>&#x8BA1;&#x7B97;&#x952E;&#x503C;&#x5BF9;&#x6240;&#x5728;&#x7684;&#x6876;&#xFF1B;</li>
<li>&#x5728;&#x94FE;&#x8868;&#x4E0A;&#x987A;&#x5E8F;&#x67E5;&#x627E;&#xFF0C;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x663E;&#x7136;&#x548C;&#x94FE;&#x8868;&#x7684;&#x957F;&#x5EA6;&#x6210;&#x6B63;&#x6BD4;&#x3002;</li>
</ul>
<p><div align="center"> <img src="https://github.com/CyC2018/Interview-Notebook/raw/master/pics/49d6de7b-0d0d-425c-9e49-a1559dc23b10.png"> </div><br></p>
<h3 id="3-put-&#x64CD;&#x4F5C;">3. put &#x64CD;&#x4F5C;</h3>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">public</span> V <span class="hljs-title">put</span><span class="hljs-params">(K key, V value)</span> </span>{
    <span class="hljs-keyword">if</span> (table == EMPTY_TABLE) {
        inflateTable(threshold);
    }
    <span class="hljs-comment">// &#x952E;&#x4E3A; null &#x5355;&#x72EC;&#x5904;&#x7406;</span>
    <span class="hljs-keyword">if</span> (key == <span class="hljs-keyword">null</span>)
        <span class="hljs-keyword">return</span> putForNullKey(value);
    <span class="hljs-keyword">int</span> hash = hash(key);
    <span class="hljs-comment">// &#x786E;&#x5B9A;&#x6876;&#x4E0B;&#x6807;</span>
    <span class="hljs-keyword">int</span> i = indexFor(hash, table.length);
    <span class="hljs-comment">// &#x5148;&#x627E;&#x51FA;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x952E;&#x4E3A; key &#x7684;&#x952E;&#x503C;&#x5BF9;&#xFF0C;&#x5982;&#x679C;&#x5B58;&#x5728;&#x7684;&#x8BDD;&#x5C31;&#x66F4;&#x65B0;&#x8FD9;&#x4E2A;&#x952E;&#x503C;&#x5BF9;&#x7684;&#x503C;&#x4E3A; value</span>
    <span class="hljs-keyword">for</span> (Entry&lt;K,V&gt; e = table[i]; e != <span class="hljs-keyword">null</span>; e = e.next) {
        Object k;
        <span class="hljs-keyword">if</span> (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) {
            V oldValue = e.value;
            e.value = value;
            e.recordAccess(<span class="hljs-keyword">this</span>);
            <span class="hljs-keyword">return</span> oldValue;
        }
    }

    modCount++;
    <span class="hljs-comment">// &#x63D2;&#x5165;&#x65B0;&#x952E;&#x503C;&#x5BF9;</span>
    addEntry(hash, key, value, i);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
}
</code></pre>
<p>HashMap &#x5141;&#x8BB8;&#x63D2;&#x5165;&#x952E;&#x4E3A; null &#x7684;&#x952E;&#x503C;&#x5BF9;&#x3002;&#x56E0;&#x4E3A;&#x65E0;&#x6CD5;&#x8C03;&#x7528; null &#x7684; hashCode()&#xFF0C;&#x4E5F;&#x5C31;&#x65E0;&#x6CD5;&#x786E;&#x5B9A;&#x8BE5;&#x952E;&#x503C;&#x5BF9;&#x7684;&#x6876;&#x4E0B;&#x6807;&#xFF0C;&#x53EA;&#x80FD;&#x901A;&#x8FC7;&#x5F3A;&#x5236;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x6876;&#x4E0B;&#x6807;&#x6765;&#x5B58;&#x653E;&#x3002;HashMap &#x4F7F;&#x7528;&#x7B2C; 0 &#x4E2A;&#x6876;&#x5B58;&#x653E;&#x952E;&#x4E3A; null &#x7684;&#x952E;&#x503C;&#x5BF9;&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">private</span> V <span class="hljs-title">putForNullKey</span><span class="hljs-params">(V value)</span> </span>{
    <span class="hljs-keyword">for</span> (Entry&lt;K,V&gt; e = table[<span class="hljs-number">0</span>]; e != <span class="hljs-keyword">null</span>; e = e.next) {
        <span class="hljs-keyword">if</span> (e.key == <span class="hljs-keyword">null</span>) {
            V oldValue = e.value;
            e.value = value;
            e.recordAccess(<span class="hljs-keyword">this</span>);
            <span class="hljs-keyword">return</span> oldValue;
        }
    }
    modCount++;
    addEntry(<span class="hljs-number">0</span>, <span class="hljs-keyword">null</span>, value, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
}
</code></pre>
<p>&#x4F7F;&#x7528;&#x94FE;&#x8868;&#x7684;&#x5934;&#x63D2;&#x6CD5;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x65B0;&#x7684;&#x952E;&#x503C;&#x5BF9;&#x63D2;&#x5728;&#x94FE;&#x8868;&#x7684;&#x5934;&#x90E8;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x94FE;&#x8868;&#x7684;&#x5C3E;&#x90E8;&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">addEntry</span><span class="hljs-params">(<span class="hljs-keyword">int</span> hash, K key, V value, <span class="hljs-keyword">int</span> bucketIndex)</span> </span>{
    <span class="hljs-keyword">if</span> ((size &gt;= threshold) &amp;&amp; (<span class="hljs-keyword">null</span> != table[bucketIndex])) {
        resize(<span class="hljs-number">2</span> * table.length);
        hash = (<span class="hljs-keyword">null</span> != key) ? hash(key) : <span class="hljs-number">0</span>;
        bucketIndex = indexFor(hash, table.length);
    }

    createEntry(hash, key, value, bucketIndex);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">createEntry</span><span class="hljs-params">(<span class="hljs-keyword">int</span> hash, K key, V value, <span class="hljs-keyword">int</span> bucketIndex)</span> </span>{
    Entry&lt;K,V&gt; e = table[bucketIndex];
    <span class="hljs-comment">// &#x5934;&#x63D2;&#x6CD5;&#xFF0C;&#x94FE;&#x8868;&#x5934;&#x90E8;&#x6307;&#x5411;&#x65B0;&#x7684;&#x952E;&#x503C;&#x5BF9;</span>
    table[bucketIndex] = <span class="hljs-keyword">new</span> Entry&lt;&gt;(hash, key, value, e);
    size++;
}
</code></pre>
<pre><code class="lang-java">Entry(<span class="hljs-keyword">int</span> h, K k, V v, Entry&lt;K,V&gt; n) {
    value = v;
    next = n;
    key = k;
    hash = h;
}
</code></pre>
<h3 id="4-&#x786E;&#x5B9A;&#x6876;&#x4E0B;&#x6807;">4. &#x786E;&#x5B9A;&#x6876;&#x4E0B;&#x6807;</h3>
<p>&#x5F88;&#x591A;&#x64CD;&#x4F5C;&#x90FD;&#x9700;&#x8981;&#x5148;&#x786E;&#x5B9A;&#x4E00;&#x4E2A;&#x952E;&#x503C;&#x5BF9;&#x6240;&#x5728;&#x7684;&#x6876;&#x4E0B;&#x6807;&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-keyword">int</span> hash = hash(key);
<span class="hljs-keyword">int</span> i = indexFor(hash, table.length);
</code></pre>
<p>&#xFF08;&#x4E00;&#xFF09;&#x8BA1;&#x7B97; hash &#x503C;</p>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> <span class="hljs-title">hash</span><span class="hljs-params">(Object k)</span> </span>{
    <span class="hljs-keyword">int</span> h = hashSeed;
    <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> != h &amp;&amp; k <span class="hljs-keyword">instanceof</span> String) {
        <span class="hljs-keyword">return</span> sun.misc.Hashing.stringHash32((String) k);
    }

    h ^= k.hashCode();

    <span class="hljs-comment">// This function ensures that hashCodes that differ only by</span>
    <span class="hljs-comment">// constant multiples at each bit position have a bounded</span>
    <span class="hljs-comment">// number of collisions (approximately 8 at default load factor).</span>
    h ^= (h &gt;&gt;&gt; <span class="hljs-number">20</span>) ^ (h &gt;&gt;&gt; <span class="hljs-number">12</span>);
    <span class="hljs-keyword">return</span> h ^ (h &gt;&gt;&gt; <span class="hljs-number">7</span>) ^ (h &gt;&gt;&gt; <span class="hljs-number">4</span>);
}
</code></pre>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> <span class="hljs-title">hashCode</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> Objects.hashCode(key) ^ Objects.hashCode(value);
}
</code></pre>
<p>&#xFF08;&#x4E8C;&#xFF09;&#x53D6;&#x6A21;</p>
<p>&#x4EE4; x = 1&lt;&lt;4&#xFF0C;&#x5373; x &#x4E3A; 2 &#x7684; 4 &#x6B21;&#x65B9;&#xFF0C;&#x5B83;&#x5177;&#x6709;&#x4EE5;&#x4E0B;&#x6027;&#x8D28;&#xFF1A;</p>
<pre><code>x   : 00010000
x-1 : 00001111
</code></pre><p>&#x4EE4;&#x4E00;&#x4E2A;&#x6570; y &#x4E0E; x-1 &#x505A;&#x4E0E;&#x8FD0;&#x7B97;&#xFF0C;&#x53EF;&#x4EE5;&#x53BB;&#x9664; y &#x4F4D;&#x7EA7;&#x8868;&#x793A;&#x7684;&#x7B2C; 4 &#x4F4D;&#x4EE5;&#x4E0A;&#x6570;&#xFF1A;</p>
<pre><code>y       : 10110010
x-1     : 00001111
y&amp;(x-1) : 00000010
</code></pre><p>&#x8FD9;&#x4E2A;&#x6027;&#x8D28;&#x548C; y &#x5BF9; x &#x53D6;&#x6A21;&#x6548;&#x679C;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF1A;</p>
<pre><code>x   : 00010000
y   : 10110010
y%x : 00000010
</code></pre><p>&#x6211;&#x4EEC;&#x77E5;&#x9053;&#xFF0C;&#x4F4D;&#x8FD0;&#x7B97;&#x7684;&#x4EE3;&#x4EF7;&#x6BD4;&#x6C42;&#x6A21;&#x8FD0;&#x7B97;&#x5C0F;&#x7684;&#x591A;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x8FDB;&#x884C;&#x8FD9;&#x79CD;&#x8BA1;&#x7B97;&#x65F6;&#x7528;&#x4F4D;&#x8FD0;&#x7B97;&#x7684;&#x8BDD;&#x80FD;&#x5E26;&#x6765;&#x66F4;&#x9AD8;&#x7684;&#x6027;&#x80FD;&#x3002;</p>
<p>&#x786E;&#x5B9A;&#x6876;&#x4E0B;&#x6807;&#x7684;&#x6700;&#x540E;&#x4E00;&#x6B65;&#x662F;&#x5C06; key &#x7684; hash &#x503C;&#x5BF9;&#x6876;&#x4E2A;&#x6570;&#x53D6;&#x6A21;&#xFF1A;hash%capacity&#xFF0C;&#x5982;&#x679C;&#x80FD;&#x4FDD;&#x8BC1; capacity &#x4E3A; 2 &#x7684; n &#x6B21;&#x65B9;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x53EF;&#x4EE5;&#x5C06;&#x8FD9;&#x4E2A;&#x64CD;&#x4F5C;&#x8F6C;&#x6362;&#x4E3A;&#x4F4D;&#x8FD0;&#x7B97;&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">indexFor</span><span class="hljs-params">(<span class="hljs-keyword">int</span> h, <span class="hljs-keyword">int</span> length)</span> </span>{
    <span class="hljs-keyword">return</span> h &amp; (length-<span class="hljs-number">1</span>);
}
</code></pre>
<h3 id="5-&#x6269;&#x5BB9;&#x57FA;&#x672C;&#x539F;&#x7406;">5. &#x6269;&#x5BB9;-&#x57FA;&#x672C;&#x539F;&#x7406;</h3>
<p>&#x8BBE; HashMap &#x7684; table &#x957F;&#x5EA6;&#x4E3A; M&#xFF0C;&#x9700;&#x8981;&#x5B58;&#x50A8;&#x7684;&#x952E;&#x503C;&#x5BF9;&#x6570;&#x91CF;&#x4E3A; N&#xFF0C;&#x5982;&#x679C;&#x54C8;&#x5E0C;&#x51FD;&#x6570;&#x6EE1;&#x8DB3;&#x5747;&#x5300;&#x6027;&#x7684;&#x8981;&#x6C42;&#xFF0C;&#x90A3;&#x4E48;&#x6BCF;&#x6761;&#x94FE;&#x8868;&#x7684;&#x957F;&#x5EA6;&#x5927;&#x7EA6;&#x4E3A; N/M&#xFF0C;&#x56E0;&#x6B64;&#x5E73;&#x5747;&#x67E5;&#x627E;&#x6B21;&#x6570;&#x7684;&#x590D;&#x6742;&#x5EA6;&#x4E3A; O(N/M)&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x8BA9;&#x67E5;&#x627E;&#x7684;&#x6210;&#x672C;&#x964D;&#x4F4E;&#xFF0C;&#x5E94;&#x8BE5;&#x5C3D;&#x53EF;&#x80FD;&#x4F7F;&#x5F97; N/M &#x5C3D;&#x53EF;&#x80FD;&#x5C0F;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x4FDD;&#x8BC1; M &#x5C3D;&#x53EF;&#x80FD;&#x5927;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4; table &#x8981;&#x5C3D;&#x53EF;&#x80FD;&#x5927;&#x3002;HashMap &#x91C7;&#x7528;&#x52A8;&#x6001;&#x6269;&#x5BB9;&#x6765;&#x6839;&#x636E;&#x5F53;&#x524D;&#x7684; N &#x503C;&#x6765;&#x8C03;&#x6574; M &#x503C;&#xFF0C;&#x4F7F;&#x5F97;&#x7A7A;&#x95F4;&#x6548;&#x7387;&#x548C;&#x65F6;&#x95F4;&#x6548;&#x7387;&#x90FD;&#x80FD;&#x5F97;&#x5230;&#x4FDD;&#x8BC1;&#x3002;</p>
<p>&#x548C;&#x6269;&#x5BB9;&#x76F8;&#x5173;&#x7684;&#x53C2;&#x6570;&#x4E3B;&#x8981;&#x6709;&#xFF1A;capacity&#x3001;size&#x3001;threshold &#x548C; load_factor&#x3002;</p>
<table>
<thead>
<tr>
<th style="text-align:center">&#x53C2;&#x6570;</th>
<th style="text-align:left">&#x542B;&#x4E49;</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">capacity</td>
<td style="text-align:left">table &#x7684;&#x5BB9;&#x91CF;&#x5927;&#x5C0F;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A; 16&#xFF0C;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F; capacity &#x5FC5;&#x987B;&#x4FDD;&#x8BC1;&#x4E3A; 2 &#x7684; n &#x6B21;&#x65B9;&#x3002;</td>
</tr>
<tr>
<td style="text-align:center">size</td>
<td style="text-align:left">table &#x7684;&#x5B9E;&#x9645;&#x4F7F;&#x7528;&#x91CF;&#x3002;</td>
</tr>
<tr>
<td style="text-align:center">threshold</td>
<td style="text-align:left">size &#x7684;&#x4E34;&#x754C;&#x503C;&#xFF0C;size &#x5FC5;&#x987B;&#x5C0F;&#x4E8E; threshold&#xFF0C;&#x5982;&#x679C;&#x5927;&#x4E8E;&#x7B49;&#x4E8E;&#xFF0C;&#x5C31;&#x5FC5;&#x987B;&#x8FDB;&#x884C;&#x6269;&#x5BB9;&#x64CD;&#x4F5C;&#x3002;</td>
</tr>
<tr>
<td style="text-align:center">load_factor</td>
<td style="text-align:left">&#x88C5;&#x8F7D;&#x56E0;&#x5B50;&#xFF0C;table &#x80FD;&#x591F;&#x4F7F;&#x7528;&#x7684;&#x6BD4;&#x4F8B;&#xFF0C;threshold = capacity * load_factor&#x3002;</td>
</tr>
</tbody>
</table>
<pre><code class="lang-java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="hljs-number">16</span>;

<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> MAXIMUM_CAPACITY = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">30</span>;

<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="hljs-number">0.75f</span>;

<span class="hljs-keyword">transient</span> Entry[] table;

<span class="hljs-keyword">transient</span> <span class="hljs-keyword">int</span> size;

<span class="hljs-keyword">int</span> threshold;

<span class="hljs-keyword">final</span> <span class="hljs-keyword">float</span> loadFactor;

<span class="hljs-keyword">transient</span> <span class="hljs-keyword">int</span> modCount;
</code></pre>
<p>&#x4ECE;&#x4E0B;&#x9762;&#x7684;&#x6DFB;&#x52A0;&#x5143;&#x7D20;&#x4EE3;&#x7801;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x5F53;&#x9700;&#x8981;&#x6269;&#x5BB9;&#x65F6;&#xFF0C;&#x4EE4; capacity &#x4E3A;&#x539F;&#x6765;&#x7684;&#x4E24;&#x500D;&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">addEntry</span><span class="hljs-params">(<span class="hljs-keyword">int</span> hash, K key, V value, <span class="hljs-keyword">int</span> bucketIndex)</span> </span>{
    Entry&lt;K,V&gt; e = table[bucketIndex];
    table[bucketIndex] = <span class="hljs-keyword">new</span> Entry&lt;&gt;(hash, key, value, e);
    <span class="hljs-keyword">if</span> (size++ &gt;= threshold)
        resize(<span class="hljs-number">2</span> * table.length);
}
</code></pre>
<p>&#x6269;&#x5BB9;&#x4F7F;&#x7528; resize() &#x5B9E;&#x73B0;&#xFF0C;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x6269;&#x5BB9;&#x64CD;&#x4F5C;&#x540C;&#x6837;&#x9700;&#x8981;&#x628A;&#x65E7; table &#x7684;&#x6240;&#x6709;&#x952E;&#x503C;&#x5BF9;&#x91CD;&#x65B0;&#x63D2;&#x5165;&#x65B0;&#x7684; table &#x4E2D;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x4E00;&#x6B65;&#x662F;&#x5F88;&#x8D39;&#x65F6;&#x7684;&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">resize</span><span class="hljs-params">(<span class="hljs-keyword">int</span> newCapacity)</span> </span>{
    Entry[] oldTable = table;
    <span class="hljs-keyword">int</span> oldCapacity = oldTable.length;
    <span class="hljs-keyword">if</span> (oldCapacity == MAXIMUM_CAPACITY) {
        threshold = Integer.MAX_VALUE;
        <span class="hljs-keyword">return</span>;
    }
    Entry[] newTable = <span class="hljs-keyword">new</span> Entry[newCapacity];
    transfer(newTable);
    table = newTable;
    threshold = (<span class="hljs-keyword">int</span>)(newCapacity * loadFactor);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">transfer</span><span class="hljs-params">(Entry[] newTable)</span> </span>{
    Entry[] src = table;
    <span class="hljs-keyword">int</span> newCapacity = newTable.length;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; src.length; j++) {
        Entry&lt;K,V&gt; e = src[j];
        <span class="hljs-keyword">if</span> (e != <span class="hljs-keyword">null</span>) {
            src[j] = <span class="hljs-keyword">null</span>;
            do {
                Entry&lt;K,V&gt; next = e.next;
                <span class="hljs-keyword">int</span> i = indexFor(e.hash, newCapacity);
                e.next = newTable[i];
                newTable[i] = e;
                e = next;
            } <span class="hljs-keyword">while</span> (e != <span class="hljs-keyword">null</span>);
        }
    }
}
</code></pre>
<h3 id="6-&#x6269;&#x5BB9;&#x91CD;&#x65B0;&#x8BA1;&#x7B97;&#x6876;&#x4E0B;&#x6807;">6. &#x6269;&#x5BB9;-&#x91CD;&#x65B0;&#x8BA1;&#x7B97;&#x6876;&#x4E0B;&#x6807;</h3>
<p>&#x5728;&#x8FDB;&#x884C;&#x6269;&#x5BB9;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x628A;&#x952E;&#x503C;&#x5BF9;&#x91CD;&#x65B0;&#x653E;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x6876;&#x4E0A;&#x3002;HashMap &#x4F7F;&#x7528;&#x4E86;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x7684;&#x673A;&#x5236;&#xFF0C;&#x53EF;&#x4EE5;&#x964D;&#x4F4E;&#x91CD;&#x65B0;&#x8BA1;&#x7B97;&#x6876;&#x4E0B;&#x6807;&#x7684;&#x64CD;&#x4F5C;&#x3002;</p>
<p>&#x5047;&#x8BBE;&#x539F;&#x6570;&#x7EC4;&#x957F;&#x5EA6; capacity &#x4E3A; 8&#xFF0C;&#x6269;&#x5BB9;&#x4E4B;&#x540E; new capacity &#x4E3A; 16&#xFF1A;</p>
<pre><code class="lang-html">capacity     : 00010000
new capacity : 00100000
</code></pre>
<p>&#x5BF9;&#x4E8E;&#x4E00;&#x4E2A; Key&#xFF0C;&#x5B83;&#x7684;&#x54C8;&#x5E0C;&#x503C;&#x5982;&#x679C;&#x5728;&#x7B2C; 6 &#x4F4D;&#x4E0A;&#x4E3A; 0&#xFF0C;&#x90A3;&#x4E48;&#x53D6;&#x6A21;&#x5F97;&#x5230;&#x7684;&#x7ED3;&#x679C;&#x548C;&#x4E4B;&#x524D;&#x4E00;&#x6837;&#xFF1B;&#x5982;&#x679C;&#x4E3A; 1&#xFF0C;&#x90A3;&#x4E48;&#x5F97;&#x5230;&#x7684;&#x7ED3;&#x679C;&#x4E3A;&#x539F;&#x6765;&#x7684;&#x7ED3;&#x679C; + 8&#x3002;</p>
<h3 id="7-&#x6269;&#x5BB9;&#x8BA1;&#x7B97;&#x6570;&#x7EC4;&#x5BB9;&#x91CF;">7. &#x6269;&#x5BB9;-&#x8BA1;&#x7B97;&#x6570;&#x7EC4;&#x5BB9;&#x91CF;</h3>
<p>HashMap &#x6784;&#x9020;&#x51FD;&#x6570;&#x5141;&#x8BB8;&#x7528;&#x6237;&#x4F20;&#x5165;&#x7684;&#x5BB9;&#x91CF;&#x4E0D;&#x662F; 2 &#x7684; n &#x6B21;&#x65B9;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x53EF;&#x4EE5;&#x81EA;&#x52A8;&#x5730;&#x5C06;&#x4F20;&#x5165;&#x7684;&#x5BB9;&#x91CF;&#x8F6C;&#x6362;&#x4E3A; 2 &#x7684; n &#x6B21;&#x65B9;&#x3002;</p>
<p>&#x5148;&#x8003;&#x8651;&#x5982;&#x4F55;&#x6C42;&#x4E00;&#x4E2A;&#x6570;&#x7684;&#x63A9;&#x7801;&#xFF0C;&#x5BF9;&#x4E8E; 10010000&#xFF0C;&#x5B83;&#x7684;&#x63A9;&#x7801;&#x4E3A; 11111111&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x65B9;&#x6CD5;&#x5F97;&#x5230;&#xFF1A;</p>
<pre><code>mask |= mask &gt;&gt; 1    11011000
mask |= mask &gt;&gt; 2    11111100
mask |= mask &gt;&gt; 4    11111111
</code></pre><p>mask+1 &#x662F;&#x5927;&#x4E8E;&#x539F;&#x59CB;&#x6570;&#x5B57;&#x7684;&#x6700;&#x5C0F;&#x7684; 2 &#x7684; n &#x6B21;&#x65B9;&#x3002;</p>
<pre><code>num     10010000
mask+1 100000000
</code></pre><p>&#x4EE5;&#x4E0B;&#x662F; HashMap &#x4E2D;&#x8BA1;&#x7B97;&#x6570;&#x7EC4;&#x5BB9;&#x91CF;&#x7684;&#x4EE3;&#x7801;&#xFF1A;</p>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> <span class="hljs-title">tableSizeFor</span><span class="hljs-params">(<span class="hljs-keyword">int</span> cap)</span> </span>{
    <span class="hljs-keyword">int</span> n = cap - <span class="hljs-number">1</span>;
    n |= n &gt;&gt;&gt; <span class="hljs-number">1</span>;
    n |= n &gt;&gt;&gt; <span class="hljs-number">2</span>;
    n |= n &gt;&gt;&gt; <span class="hljs-number">4</span>;
    n |= n &gt;&gt;&gt; <span class="hljs-number">8</span>;
    n |= n &gt;&gt;&gt; <span class="hljs-number">16</span>;
    <span class="hljs-keyword">return</span> (n &lt; <span class="hljs-number">0</span>) ? <span class="hljs-number">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class="hljs-number">1</span>;
}
</code></pre>
<h3 id="8-&#x94FE;&#x8868;&#x8F6C;&#x7EA2;&#x9ED1;&#x6811;">8. &#x94FE;&#x8868;&#x8F6C;&#x7EA2;&#x9ED1;&#x6811;</h3>
<p>&#x4ECE; JDK 1.8 &#x5F00;&#x59CB;&#xFF0C;&#x4E00;&#x4E2A;&#x6876;&#x5B58;&#x50A8;&#x7684;&#x94FE;&#x8868;&#x957F;&#x5EA6;&#x5927;&#x4E8E; 8 &#x65F6;&#x4F1A;&#x5C06;&#x94FE;&#x8868;&#x8F6C;&#x6362;&#x4E3A;&#x7EA2;&#x9ED1;&#x6811;&#x3002;</p>
<h3 id="9-hashmap-&#x4E0E;-hashtable">9. HashMap &#x4E0E; HashTable</h3>
<ul>
<li>HashTable &#x4F7F;&#x7528; synchronized &#x6765;&#x8FDB;&#x884C;&#x540C;&#x6B65;&#x3002;</li>
<li>HashMap &#x53EF;&#x4EE5;&#x63D2;&#x5165;&#x952E;&#x4E3A; null &#x7684; Entry&#x3002;</li>
<li>HashMap &#x7684;&#x8FED;&#x4EE3;&#x5668;&#x662F; fail-fast &#x8FED;&#x4EE3;&#x5668;&#x3002;</li>
<li>HashMap &#x4E0D;&#x80FD;&#x4FDD;&#x8BC1;&#x968F;&#x7740;&#x65F6;&#x95F4;&#x7684;&#x63A8;&#x79FB; Map &#x4E2D;&#x7684;&#x5143;&#x7D20;&#x6B21;&#x5E8F;&#x662F;&#x4E0D;&#x53D8;&#x7684;&#x3002;</li>
</ul>
<h2 id="concurrenthashmap">ConcurrentHashMap</h2>
<h3 id="1-&#x5B58;&#x50A8;&#x7ED3;&#x6784;">1. &#x5B58;&#x50A8;&#x7ED3;&#x6784;</h3>
<pre><code class="lang-java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HashEntry</span>&lt;<span class="hljs-title">K</span>,<span class="hljs-title">V</span>&gt; </span>{
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> hash;
    <span class="hljs-keyword">final</span> K key;
    <span class="hljs-keyword">volatile</span> V value;
    <span class="hljs-keyword">volatile</span> HashEntry&lt;K,V&gt; next;
}
</code></pre>
<p>ConcurrentHashMap &#x548C; HashMap &#x5B9E;&#x73B0;&#x4E0A;&#x7C7B;&#x4F3C;&#xFF0C;&#x6700;&#x4E3B;&#x8981;&#x7684;&#x5DEE;&#x522B;&#x662F; ConcurrentHashMap &#x91C7;&#x7528;&#x4E86;&#x5206;&#x6BB5;&#x9501;&#xFF08;Segment&#xFF09;&#xFF0C;&#x6BCF;&#x4E2A;&#x5206;&#x6BB5;&#x9501;&#x7EF4;&#x62A4;&#x7740;&#x51E0;&#x4E2A;&#x6876;&#xFF08;HashEntry&#xFF09;&#xFF0C;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x53EF;&#x4EE5;&#x540C;&#x65F6;&#x8BBF;&#x95EE;&#x4E0D;&#x540C;&#x5206;&#x6BB5;&#x9501;&#x4E0A;&#x7684;&#x6876;&#xFF0C;&#x4ECE;&#x800C;&#x4F7F;&#x5176;&#x5E76;&#x53D1;&#x5EA6;&#x66F4;&#x9AD8;&#xFF08;&#x5E76;&#x53D1;&#x5EA6;&#x5C31;&#x662F; Segment &#x7684;&#x4E2A;&#x6570;&#xFF09;&#x3002;</p>
<p>Segment &#x7EE7;&#x627F;&#x81EA; ReentrantLock&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Segment</span>&lt;<span class="hljs-title">K</span>,<span class="hljs-title">V</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">ReentrantLock</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = <span class="hljs-number">2249069246763182397L</span>;

    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> MAX_SCAN_RETRIES =
        Runtime.getRuntime().availableProcessors() &gt; <span class="hljs-number">1</span> ? <span class="hljs-number">64</span> : <span class="hljs-number">1</span>;

    <span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> HashEntry&lt;K,V&gt;[] table;

    <span class="hljs-keyword">transient</span> <span class="hljs-keyword">int</span> count;

    <span class="hljs-keyword">transient</span> <span class="hljs-keyword">int</span> modCount;

    <span class="hljs-keyword">transient</span> <span class="hljs-keyword">int</span> threshold;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">float</span> loadFactor;
}
</code></pre>
<pre><code class="lang-java"><span class="hljs-keyword">final</span> Segment&lt;K,V&gt;[] segments;
</code></pre>
<p>&#x9ED8;&#x8BA4;&#x7684;&#x5E76;&#x53D1;&#x7EA7;&#x522B;&#x4E3A; 16&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x9ED8;&#x8BA4;&#x521B;&#x5EFA; 16 &#x4E2A; Segment&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> DEFAULT_CONCURRENCY_LEVEL = <span class="hljs-number">16</span>;
</code></pre>
<p><div align="center"> <img src="https://github.com/CyC2018/Interview-Notebook/raw/master/pics/3fdfc89d-719e-4d93-b518-29fa612b3b18.png"> </div><br></p>
<h3 id="2-size-&#x64CD;&#x4F5C;">2. size &#x64CD;&#x4F5C;</h3>
<p>&#x6BCF;&#x4E2A; Segment &#x7EF4;&#x62A4;&#x4E86;&#x4E00;&#x4E2A; count &#x53D8;&#x91CF;&#x6765;&#x7EDF;&#x8BA1;&#x8BE5; Segment &#x4E2D;&#x7684;&#x952E;&#x503C;&#x5BF9;&#x4E2A;&#x6570;&#x3002;</p>
<pre><code class="lang-java"><span class="hljs-comment">/**
 * The number of elements. Accessed only either within locks
 * or among other volatile reads that maintain visibility.
 */</span>
<span class="hljs-keyword">transient</span> <span class="hljs-keyword">int</span> count;
</code></pre>
<p>&#x5728;&#x6267;&#x884C; size &#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x904D;&#x5386;&#x6240;&#x6709; Segment &#x7136;&#x540E;&#x628A; count &#x7D2F;&#x8BA1;&#x8D77;&#x6765;&#x3002;</p>
<p>ConcurrentHashMap &#x5728;&#x6267;&#x884C; size &#x64CD;&#x4F5C;&#x65F6;&#x5148;&#x5C1D;&#x8BD5;&#x4E0D;&#x52A0;&#x9501;&#xFF0C;&#x5982;&#x679C;&#x8FDE;&#x7EED;&#x4E24;&#x6B21;&#x4E0D;&#x52A0;&#x9501;&#x64CD;&#x4F5C;&#x5F97;&#x5230;&#x7684;&#x7ED3;&#x679C;&#x4E00;&#x81F4;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x8BA4;&#x4E3A;&#x8FD9;&#x4E2A;&#x7ED3;&#x679C;&#x662F;&#x6B63;&#x786E;&#x7684;&#x3002;</p>
<p>&#x5C1D;&#x8BD5;&#x6B21;&#x6570;&#x4F7F;&#x7528; RETRIES_BEFORE_LOCK &#x5B9A;&#x4E49;&#xFF0C;&#x8BE5;&#x503C;&#x4E3A; 2&#xFF0C;retries &#x521D;&#x59CB;&#x503C;&#x4E3A; -1&#xFF0C;&#x56E0;&#x6B64;&#x5C1D;&#x8BD5;&#x6B21;&#x6570;&#x4E3A; 3&#x3002;</p>
<p>&#x5982;&#x679C;&#x5C1D;&#x8BD5;&#x7684;&#x6B21;&#x6570;&#x8D85;&#x8FC7; 3 &#x6B21;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x5BF9;&#x6BCF;&#x4E2A; Segment &#x52A0;&#x9501;&#x3002;</p>
<pre><code class="lang-java">
<span class="hljs-comment">/**
 * Number of unsynchronized retries in size and containsValue
 * methods before resorting to locking. This is used to avoid
 * unbounded retries if tables undergo continuous modification
 * which would make it impossible to obtain an accurate result.
 */</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> RETRIES_BEFORE_LOCK = <span class="hljs-number">2</span>;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">size</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// Try a few times to get accurate count. On failure due to</span>
    <span class="hljs-comment">// continuous async changes in table, resort to locking.</span>
    <span class="hljs-keyword">final</span> Segment&lt;K,V&gt;[] segments = <span class="hljs-keyword">this</span>.segments;
    <span class="hljs-keyword">int</span> size;
    <span class="hljs-keyword">boolean</span> overflow; <span class="hljs-comment">// true if size overflows 32 bits</span>
    <span class="hljs-keyword">long</span> sum;         <span class="hljs-comment">// sum of modCounts</span>
    <span class="hljs-keyword">long</span> last = <span class="hljs-number">0L</span>;   <span class="hljs-comment">// previous sum</span>
    <span class="hljs-keyword">int</span> retries = -<span class="hljs-number">1</span>; <span class="hljs-comment">// first iteration isn&apos;t retry</span>
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">for</span> (;;) {
            <span class="hljs-comment">// &#x8D85;&#x8FC7;&#x5C1D;&#x8BD5;&#x6B21;&#x6570;&#xFF0C;&#x5219;&#x5BF9;&#x6BCF;&#x4E2A; Segment &#x52A0;&#x9501;</span>
            <span class="hljs-keyword">if</span> (retries++ == RETRIES_BEFORE_LOCK) {
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; segments.length; ++j)
                    ensureSegment(j).lock(); <span class="hljs-comment">// force creation</span>
            }
            sum = <span class="hljs-number">0L</span>;
            size = <span class="hljs-number">0</span>;
            overflow = <span class="hljs-keyword">false</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; segments.length; ++j) {
                Segment&lt;K,V&gt; seg = segmentAt(segments, j);
                <span class="hljs-keyword">if</span> (seg != <span class="hljs-keyword">null</span>) {
                    sum += seg.modCount;
                    <span class="hljs-keyword">int</span> c = seg.count;
                    <span class="hljs-keyword">if</span> (c &lt; <span class="hljs-number">0</span> || (size += c) &lt; <span class="hljs-number">0</span>)
                        overflow = <span class="hljs-keyword">true</span>;
                }
            }
            <span class="hljs-comment">// &#x8FDE;&#x7EED;&#x4E24;&#x6B21;&#x5F97;&#x5230;&#x7684;&#x7ED3;&#x679C;&#x4E00;&#x81F4;&#xFF0C;&#x5219;&#x8BA4;&#x4E3A;&#x8FD9;&#x4E2A;&#x7ED3;&#x679C;&#x662F;&#x6B63;&#x786E;&#x7684;</span>
            <span class="hljs-keyword">if</span> (sum == last)
                <span class="hljs-keyword">break</span>;
            last = sum;
        }
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">if</span> (retries &gt; RETRIES_BEFORE_LOCK) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; segments.length; ++j)
                segmentAt(segments, j).unlock();
        }
    }
    <span class="hljs-keyword">return</span> overflow ? Integer.MAX_VALUE : size;
}
</code></pre>
<h3 id="3-jdk-18-&#x7684;&#x6539;&#x52A8;">3. JDK 1.8 &#x7684;&#x6539;&#x52A8;</h3>
<p>JDK 1.7 &#x4F7F;&#x7528;&#x5206;&#x6BB5;&#x9501;&#x673A;&#x5236;&#x6765;&#x5B9E;&#x73B0;&#x5E76;&#x53D1;&#x66F4;&#x65B0;&#x64CD;&#x4F5C;&#xFF0C;&#x6838;&#x5FC3;&#x7C7B;&#x4E3A; Segment&#xFF0C;&#x5B83;&#x7EE7;&#x627F;&#x81EA;&#x91CD;&#x5165;&#x9501; ReentrantLock&#xFF0C;&#x5E76;&#x53D1;&#x7A0B;&#x5EA6;&#x4E0E; Segment &#x6570;&#x91CF;&#x76F8;&#x7B49;&#x3002;</p>
<p>JDK 1.8 &#x4F7F;&#x7528;&#x4E86; CAS &#x64CD;&#x4F5C;&#x6765;&#x652F;&#x6301;&#x66F4;&#x9AD8;&#x7684;&#x5E76;&#x53D1;&#x5EA6;&#xFF0C;&#x5728; CAS &#x64CD;&#x4F5C;&#x5931;&#x8D25;&#x65F6;&#x4F7F;&#x7528;&#x5185;&#x7F6E;&#x9501; synchronized&#x3002;</p>
<p>&#x5E76;&#x4E14; JDK 1.8 &#x7684;&#x5B9E;&#x73B0;&#x4E5F;&#x5728;&#x94FE;&#x8868;&#x8FC7;&#x957F;&#x65F6;&#x4F1A;&#x8F6C;&#x6362;&#x4E3A;&#x7EA2;&#x9ED1;&#x6811;&#x3002;</p>
<h1 id="&#x53C2;&#x8003;&#x8D44;&#x6599;">&#x53C2;&#x8003;&#x8D44;&#x6599;</h1>
<ul>
<li>Eckel B. Java &#x7F16;&#x7A0B;&#x601D;&#x60F3; [M]. &#x673A;&#x68B0;&#x5DE5;&#x4E1A;&#x51FA;&#x7248;&#x793E;, 2002.</li>
<li><a href="https://www.w3resource.com/java-tutorial/java-collections.php" target="_blank">Java Collection Framework</a></li>
<li><a href="https://openhome.cc/Gossip/DesignPattern/IteratorPattern.htm" target="_blank">Iterator &#x6A21;&#x5F0F;</a></li>
<li><a href="https://tech.meituan.com/java-hashmap.html" target="_blank">Java 8 &#x7CFB;&#x5217;&#x4E4B;&#x91CD;&#x65B0;&#x8BA4;&#x8BC6; HashMap</a></li>
<li><a href="http://javarevisited.blogspot.hk/2010/10/difference-between-hashmap-and.html" target="_blank">What is difference between HashMap and Hashtable in Java?</a></li>
<li><a href="http://www.zhangchangle.com/2018/02/07/Java%E9%9B%86%E5%90%88%E4%B9%8BHashMap/" target="_blank">Java &#x96C6;&#x5408;&#x4E4B; HashMap</a></li>
<li><a href="http://www.programering.com/a/MDO3QDNwATM.html" target="_blank">The principle of ConcurrentHashMap analysis</a></li>
<li><a href="https://www.ibm.com/developerworks/cn/java/java-lo-concurrenthashmap/" target="_blank">&#x63A2;&#x7D22; ConcurrentHashMap &#x9AD8;&#x5E76;&#x53D1;&#x6027;&#x7684;&#x5B9E;&#x73B0;&#x673A;&#x5236;</a></li>
<li><a href="https://www.jianshu.com/p/75adf47958a7" target="_blank">HashMap &#x76F8;&#x5173;&#x9762;&#x8BD5;&#x9898;&#x53CA;&#x5176;&#x89E3;&#x7B54;</a></li>
<li><a href="http://wiki.jikexueyuan.com/project/java-enhancement/java-thirtysix.html" target="_blank">Java &#x96C6;&#x5408;&#x7EC6;&#x8282;&#xFF08;&#x4E8C;&#xFF09;&#xFF1A;asList &#x7684;&#x7F3A;&#x9677;</a></li>
<li><a href="http://javaconceptoftheday.com/java-collection-framework-linkedlist-class/" target="_blank">Java Collection Framework &#x2013; The LinkedList Class</a></li>
</ul>
<hr>
<p>github: <a href="https://github.com/sjsdfg/Interview-Notebook-PDF" target="_blank">https://github.com/sjsdfg/Interview-Notebook-PDF</a></p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./Java 基础.html" class="navigation navigation-prev " aria-label="Previous page: Java 基础"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./Java 并发.html" class="navigation navigation-next " aria-label="Next page: Java 并发"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

    
    <script src="gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
